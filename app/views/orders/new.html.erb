<div class="hero_wrapper">
  <div class="manual_order_wrapper">
    <div class="manual_order_header">
      <%= link_to 'javascript:;',  class: "back_btn_wrap" do %>
        <%= image_tag 'start_icon.png', alt: 'icon', class: 'back_icon' %>
        <span>Back to My Products</span>
      <% end %>
      <div class="header_text">Order ID #1111</div>
    </div>

    <div class="manual_content_wrap">
      <div class="new_product_section">
        <div class="form_step">
          <span class="step choose_products">1</span>
          <span class="step shipping">2</span>
          <span class="step submit_offers">3</span>
        </div>
        <%= link_to add_new_product_orders_path, class: "new_product_btn" do %>
          <%= image_tag 'shopping_cart.png', alt: 'icon', class: 'cart_icon' %>
          <span class="new_text">Add New Products</span>
        <% end %>

        <div class="new_product_btn">
          <%= image_tag 'shopping_cart.png', alt: 'icon', class: 'cart_icon' %>
          <span class="new_text">Add New Products</span>
        </div>
      </div>
      <%= form_tag orders_path, method: :post,  multipart: true, id: 'regForm', class: 'product_form' do %>
        <div class="tab">
          <div class="product_list_section">
            <div class="ship_from_wrap">
              <div class="icon_wrap">
                <%= image_tag "truck" %>
                <% if @order.producer.present? %>
                  <div class="icon_text">Ships from <%=@order.producer.name%></div>
                <% else %>

                  <a href="<%= all_producer_orders_path %>"  data-turbo-frame="all-producer-order-modal" class= "choose_pro_link">
                    <span>Choose Producer</span>
                    <%= image_tag 'edit_row.png', alt: 'icon', class: 'choose_icon' %>
                  </a>

                <% end %>
              </div>
              <turbo-frame id="all-producer-order-modal"></turbo-frame>
              <%= image_tag 'ic_expand_more.png', alt: 'icon', class: 'toggle_icon' %>
            </div>
            <div class="collapse_data">
              <% @products.each do |product| %>
                <% product.variants.each do |variant|%>
                  <input type="hidden" name="variant" class="variantId" id="<%= variant.id %>">
                  <div class="content_container">
                    <div class="left_wrap">
                      <div class="card_wrapper">
                        <div class="card_head"><%=variant.product.name %></div>
                        <div class="card_img_wrapper">
                          <div class="content_img">
                            <div class="image_box">
                              <% if variant.image.attached? %>
                                <%= image_tag variant.image %>
                              <% else %>
                                <%= image_tag asset_path('dummy-product.png') %>
                              <% end %>
                            </div>
                            <div class="btn_wrap">
                              <button class="outline_btn"><%= variant.color%></button>
                              <div class="plus_minus_wrap">
                                <%= hidden_field_tag "variants[#{variant.id}]", 0, class: "quantity_input qty", maxlength: "12", value: "0" %>
                                <span class="qty_num" id="qty_num_<%= variant.id %>">0</span>
                                <div class="button-container">
                                  <button class="cart-qty-minus" type="button" value="-">-</button>
                                  <button class="cart-qty-plus" type="button" value="+">+</button>
                                </div>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                      <div class="card_wrapper">
                        <div class="card_head">Front Side</div>
                        <div class="card_img_wrapper">
                          <div class="content_img shadow_box">
                            <div class="image_box">
                              <div class="avatar-upload">
                                <div class="avatar-edit">
                                  <%= file_field_tag "front_side_image", accept: ".png, .jpg, .jpeg", class: "upload_field", id: "front_side_image_#{variant.id}" %>
                                  <label for="front_side_image_<%= variant.id %>" class="upload_wrapper">
                                    <%= image_tag 'upload.png', alt: 'icon', class: 'upload_icon' %>
                                    <div class="image_type">PNG</div>
                                    <div class="upload_text">Upload Here</div>
                                    <div class="click_here">Click here to upload</div>
                                  </label>
                                </div>

                                <div class="avatar-preview">
                                  <div id="imageFrontPreview_<%= variant.id %>" style="background-image: url(http://i.pravatar.cc/500?img=7);">
                                  </div>
                                </div>
                              </div>

                            </div>
                            <div class="btn_wrap">
                              <%= link_to 'javascript:;', class: 'delete_img' do %>
                                <%= image_tag 'ic_trash.png', alt: 'icon' %>
                              <% end %>
                            </div>
                          </div>
                        </div>
                      </div>
                      <div class="card_wrapper">
                        <div class="card_head">Back Side</div>
                        <div class="card_img_wrapper">
                          <div class="content_img shadow_box">
                            <div class="image_box">
                              <div class="avatar-upload">
                                <div class="avatar-edit">
                                  <%= file_field_tag "back_side_image", accept: ".png, .jpg, .jpeg", class: "upload_field", id: "back_side_image_#{variant.id}" %>
                                  <label for="imageUpload_<%= variant.id %>" class="upload_wrapper">
                                    <%= image_tag 'upload.png', alt: 'icon', class: 'upload_icon' %>
                                    <div class="image_type">PNG</div>
                                    <div class="upload_text">Upload Here</div>
                                    <div class="click_here">Click here to upload</div>
                                  </label>
                                </div>

                                <div class="avatar-preview">
                                  <div id="imageBackPreview_<%= variant.id %>" style="background-image: url(http://i.pravatar.cc/500?img=7);">
                                  </div>
                                </div>
                              </div>
                            </div>
                            <div class="btn_wrap">
                              <%= link_to 'javascript:;', class: 'delete_img' do %>
                                <%= image_tag 'ic_trash.png', alt: 'icon' %>
                              <% end %>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                    <div class="right_wrap">
                      <%= link_to 'javascript:;', class: 'link_box' do %>
                        <%= image_tag 'ic_trash.png', alt: 'icon', class: 'trash' %>
                      <% end %>
                      <%= link_to 'javascript:;', class: 'link_box' do %>
                        <%= image_tag 'copy.png', alt: 'icon', class: 'copy' %>
                      <% end %>
                    </div>
                  </div>
                <%end%>
              <%end%>
            </div>
          </div>

          <div class="product_list_section upload_file_wrap">
            <div class="ship_from_wrap">
              <div class="icon_wrap">
                <div class="icon_text">Upload File</div>
              </div>
              <%= image_tag 'ic_expand_more.png', alt: 'icon', class: 'toggle_icon' %>
            </div>
            <div class="collapse_data">
              <div class="upload_section">
                <div class="upload_box">
                  <div class="upload_header">Shipping Label</div>
                  <div class="upload_item">
                    <%= file_field_tag "shipping_label_image", class: 'file_upload' %>
                    <label class="upload_label" for="shipping_label_image">
                      <%= image_tag 'ic_cloud_upload.png', alt: 'icon', class: 'upload_cloud' %>
                      <div class="upload_text">Upload file</div>
                    </label>
                  </div>
                </div>
                <div class="upload_box">
                  <div class="upload_header">Packing Slip</div>
                  <div class="upload_item">
                    <%= file_field_tag "packing_slip_image", class: 'file_upload' %>
                    <label class="upload_label" for="packing_slip_image">
                      <%= image_tag 'ic_cloud_upload.png', alt: 'icon', class: 'upload_cloud' %>
                      <div class="upload_text">Upload file</div>
                    </label>
                  </div>
                </div>
                <div class="upload_box">
                  <div class="upload_header">Gift Message Slip</div>
                  <div class="upload_item">
                    <%= file_field_tag "gift_message_slip_image", class: 'file_upload' %>
                    <label class="upload_label" for="gift_message_slip_image">
                      <%= image_tag 'ic_cloud_upload.png', alt: 'icon', class: 'upload_cloud' %>
                      <div class="upload_text">Upload file</div>
                    </label>
                  </div>
                </div>
                <div class="upload_box">
                  <div class="upload_header">Design File 1</div>
                  <div class="upload_item">
                    <%= file_field_tag "design_file_1_image", class: 'file_upload' %>
                    <label class="upload_label" for="design_file_1_image">
                      <%= image_tag 'ic_cloud_upload.png', alt: 'icon', class: 'upload_cloud' %>
                      <div class="upload_text">Upload file</div>
                    </label>
                  </div>
                </div>
                <div class="upload_box">
                  <div class="upload_header">Design File 2</div>
                  <div class="upload_item">
                    <%= file_field_tag "design_file_2_image", class: 'file_upload' %>
                    <label class="upload_label" for="design_file_2_image">
                      <%= image_tag 'ic_cloud_upload.png', alt: 'icon', class: 'upload_cloud' %>
                      <div class="upload_text">Upload file</div>
                    </label>
                  </div>
                </div>
                <div class="upload_box">
                  <div class="upload_header">Additional File</div>
                  <div class="upload_item">
                    <%= file_field_tag "additional_file_image", class: 'file_upload' %>
                    <label class="upload_label" for="additional_file_image">
                      <%= image_tag 'ic_cloud_upload.png', alt: 'icon', class: 'upload_cloud' %>
                      <div class="upload_text">Upload file</div>
                    </label>
                  </div>
                </div>             
              </div>
            </div>
          </div>

          <div class="product_list_section additional_comments_wrap">
            <div class="ship_from_wrap">
              <div class="icon_wrap">
                <div class="icon_text"><%= label_tag :additional_comment %></div>
              </div>
              <%= image_tag 'ic_expand_more.png', alt: 'icon', class: 'toggle_icon' %>
            </div>
            <div class="collapse_data">
              <div class="leave_any">
                <label>Leave any additional comments here</label>
                <%= text_field_tag :additional_comment %>
              </div>
            </div>
          </div>
        </div>

<!--         <div class="tab">Shipping</div>
        <div class="tab">Submit Orders</div> -->


        <div class="btn_wrapper mb-5">
          <button class="btn_wrap">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none">
              <path d="M16.62 6.20999C16.4109 6.04445 16.1444 5.96929 15.8796 6.00121C15.6148 6.03314 15.3738 6.1695 15.21 6.37999L8.21001 15.38L4.78001 11.2C4.56095 10.9084 4.20051 10.7592 3.83944 10.8106C3.47837 10.8621 3.17395 11.106 3.04503 11.4472C2.91612 11.7883 2.98318 12.1726 3.22001 12.45L7.39001 17.63C7.58064 17.865 7.86742 18.001 8.17001 18C8.49172 18.0144 8.80067 17.8729 9.00001 17.62L16.83 7.61999C16.9913 7.40592 17.0598 7.13608 17.0204 6.871C16.9809 6.60592 16.8366 6.36778 16.62 6.20999Z" fill="white"/>
              <path d="M21.62 6.20999C21.4109 6.04445 21.1444 5.96929 20.8796 6.00121C20.6148 6.03314 20.3738 6.1695 20.21 6.37999L13.21 15.38L12.6 14.63L11.34 16.25L12.44 17.62C12.6306 17.855 12.9174 17.991 13.22 17.99C13.5243 17.9886 13.8114 17.8487 14 17.61L21.83 7.60999C21.9881 7.39659 22.0548 7.12907 22.0154 6.86643C21.976 6.6038 21.8337 6.36762 21.62 6.20999Z" fill="white"/>
              <path d="M8.71001 13.06L10 11.44L9.80001 11.2C9.64048 10.979 9.39763 10.8327 9.12768 10.7949C8.85773 10.7571 8.58406 10.8312 8.37001 11C8.16253 11.1667 8.03005 11.4092 8.00189 11.6738C7.97374 11.9384 8.05224 12.2034 8.22001 12.41L8.71001 13.06Z" fill="white"/>
            </svg>
            Marked as Completed
          </button>

          <%= hidden_field_tag :user_id, params[:producer_id] %>
          <button class="btn_wrap dark_green"><%= submit_tag 'Marked as Completed', class: 'btn_wrap dark_green'%></button>
          <button class="btn_wrap light_green"><%= submit_tag 'Save Order for Later', class: 'btn_wrap light_green'%></button>

          <button type="button" id="prevBtn" onclick="nextPrev(-1)">Previous</button>
          <button type="button" id="nextBtn" onclick="nextPrev(1)">Next</button>
        </div>
        </div>
      <% end %>
    </div>
  </div>

</div>


<div class="select_pop_wrap_model choose" style="display: none;">
  <div class=" select_pop_wrap_outer">
    <div class="select_pop_wrap">
      <div class="select_head">
        Choose a Product
        <%= image_tag "red_close", alt:"icon", class:"close_icon" %>
      </div>
      <div class="select_content">
        <div class="content_head">PRODUCER 1</div>
        <div class="select_search_box">
          <%= image_tag "search", alt:"icon", class:"search_icon" %>
          <input class="search_input" type="text" placeholder="Search Product" >
        </div>
        <div class="content_text">Available Products</div>
        <div class="scroll_section">
          <% 5.times do %>
          <div class="scroll_content">
            <div class="image_text_wrap">
              <%= image_tag "IMG", alt:"image", class:"img_logo" %>
              20oz YETI Tumbler
            </div>
            <%= image_tag "right_arrow", alt:"icon", class:"rigth_arrow" %>
          </div>
          <%end%>
        </div>
        <div class="back_to_btn_section">
          <button class="back_to_btn">
            <%= image_tag "dark_start_icon", alt:"icon", class:"icon" %>
            <div class="btn_text">Back to Choose a Producer</div>
          </button>
        </div>
      </div>
    </div>
  </div>
</div>


<!-- product select variant -->
<div class="select_pop_wrap_model variant_pop" style="display: none;">
  <div class=" select_pop_wrap_outer">
    <div class="select_pop_wrap">
      <div class="select_head">
        Choose a Product
        <%= image_tag "red_close", alt:"icon", class:"close_icon" %>
      </div>
      <div class="select_content">
        <!-- <div class="content_head">PRODUCER 1</div> -->
        <div class="select_search_box">
          <%= image_tag "search", alt:"icon", class:"search_icon" %>
          <input class="search_input" type="text" placeholder="Search Variant" >
        </div>
        <div class="product_name">
          <span>PRODUCER 1</span> 
          <%= image_tag "Divider", alt:"icon", class:"devider_icon" %> 
          <%= image_tag "Divider", alt:"icon", class:"devider_icon" %>
          <span>20 oz YETI Tumbler</span>
        </div>

        <div class="selected_flash">
          1 Item Selected
          <button class="selected_btn">
            Continue with Selected Items
            <%= image_tag "add_cart", alt:"icon", class:"add_icon" %>
          </button>
        </div>

        <div class="content_text">Available Products</div>
        <div class="scroll_section">
          <% 5.times do %>
          <div class="scroll_content check_content">
            <div class="image_text_wrap">
              <input class="check_box" type="checkbox">
              <%= image_tag "IMG", alt:"image", class:"img_logo" %>
              20oz YETI Tumbler
            </div>
            <%#= image_tag "right_arrow", alt:"icon", class:"rigth_arrow" %>
          </div>
          <%end%>
        </div>
        <div class="back_to_btn_section">
          <button class="back_to_btn">
            <%= image_tag "dark_start_icon", alt:"icon", class:"icon" %>
            <div class="btn_text">Back to Choose a Producer</div>
          </button>
        </div>
      </div>
    </div>
  </div>
</div>


<div class="select_pop_wrap_model choose_producer" style="display: none;">
  <div class=" select_pop_wrap_outer">
    <div class="select_pop_wrap">
      <div class="select_head">
        Choose a Product
        <%= image_tag "red_close", alt:"icon", class:"close_icon" %>
      </div>
      <div class="select_content">
    <!--     <div class="content_head">PRODUCER 1</div>
        <div class="select_search_box">
          <%#= image_tag "search", alt:"icon", class:"search_icon" %>
          <input class="search_input" type="text" placeholder="Search Product" >
        </div>
        <div class="content_text">Available Products</div> -->
        <div class="scroll_section">
          <% 5.times do %>
          <div class="scroll_content">
            <div class="image_text_wrap">
              <%= image_tag "trans_glas", alt:"image", class:"img_logo" %>
              <div class="text_wrap">
                Producer 1
                <div class="light_text">Ships From: Buffalo, NY</div>
              </div>
              <label class="image_label">LASER ENGRAVING</label>
            </div>
            <button class="choose_btn">Choose</button>
            <%#= image_tag "right_arrow", alt:"icon", class:"rigth_arrow" %>
          </div>
          <%end%>
        </div>
    <!--     <div class="back_to_btn_section">
          <button class="back_to_btn">
            <%= image_tag "dark_start_icon", alt:"icon", class:"icon" %>
            <div class="btn_text">Back to Choose a Producer</div>
          </button>
        </div> -->
      </div>
    </div>
  </div>
</div>


<script type="text/javascript">

  $('.toggle_icon').click(function() {
    $(this).toggleClass('rotate_icon');
    $(this).closest('.product_list_section').find('.collapse_data').slideToggle();
  });

  $('.variantId').each(function() {
    var varientId = $(this).attr('id');

    function readFrontURL(input) {
      if (input.files && input.files[0]) {
        var reader = new FileReader();
        reader.onload = function(e) {
          $('#imageFrontPreview_'+varientId).css('background-image', 'url('+e.target.result +')');
          $('#imageFrontPreview_'+varientId).hide();
          $('#imageFrontPreview_'+varientId).fadeIn(650);
        }
        reader.readAsDataURL(input.files[0]);
      }
    }
    $("#front_side_image_"+varientId).change(function() {
      readFrontURL(this);
      $(this).closest('.avatar-upload').find('.avatar-edit').css('display', 'none');
      $(this).closest('.avatar-upload').find('.avatar-preview').show();
      $(this).closest('.content_img').find('.delete_img').css('display', 'flex');
    });

    function readBackURL(input) {
      if (input.files && input.files[0]) {
        var reader = new FileReader();
        reader.onload = function(e) {
          $('#imageBackPreview_'+varientId).css('background-image', 'url('+e.target.result +')');
          $('#imageBackPreview_'+varientId).hide();
          $('#imageBackPreview_'+varientId).fadeIn(650);
        }
        reader.readAsDataURL(input.files[0]);
      }
    }
    $("#back_side_image_"+varientId).change(function() {
      readBackURL(this);
      $(this).closest('.avatar-upload').find('.avatar-edit').css('display', 'none');
      $(this).closest('.avatar-upload').find('.avatar-preview').show();
      $(this).closest('.content_img').find('.delete_img').css('display', 'flex');
    });


    // increment decrement product js
    var incrementPlus;
    var incrementMinus;

    var buttonPlus  = $(".cart-qty-plus");
    var buttonMinus = $(".cart-qty-minus");

    var incrementPlus = buttonPlus.click(function() {
      var $n = $(this)
        .parent(".button-container")
        .parent(".plus_minus_wrap")
        .find("#variants_"+varientId);
      $n.val(Number($n.val())+1 );
      var proVal = $("#variants_"+varientId).val()
      $('#qty_num_'+varientId).text(proVal);
    });

    var incrementMinus = buttonMinus.click(function() {
        var $n = $(this)
        .parent(".button-container")
        .parent(".plus_minus_wrap")
        .find("#variants_"+varientId);
      var amount = Number($n.val());
      if (amount > 0) {
        $n.val(amount-1);
        var proVal = $("#variants_"+varientId).val()
        $('#qty_num_'+varientId).text(proVal);
      }
    });
  });

  $('.delete_img').click(function() {
    $(this).closest('.content_img').find('.avatar-edit').css('display', 'flex').find('.upload_field').val('');
    $(this).closest('.content_img').find('.avatar-preview').hide();
    $(this).closest('.content_img').find('.delete_img').hide();
  });


  var currentTab = 0; // Current tab is set to be the first tab (0)
  showTab(currentTab); // Display the current tab

  function showTab(n) {
    // This function will display the specified tab of the form...
    var x = document.getElementsByClassName("tab");
    x[n].style.display = "block";
    //... and fix the Previous/Next buttons:
    if (n == 0) {
      document.getElementById("prevBtn").style.display = "none";
    } else {
      document.getElementById("prevBtn").style.display = "inline";
    }
    if (n == (x.length - 1)) {
      document.getElementById("nextBtn").innerHTML = "Submit";
    } else {
      document.getElementById("nextBtn").innerHTML = "Next";
    }
    //... and run a function that will display the correct step indicator:
    fixStepIndicator(n)
  }

  function nextPrev(n) {
    // This function will figure out which tab to display
    var x = document.getElementsByClassName("tab");
    // Exit the function if any field in the current tab is invalid:
    if (n == 1 && !validateForm()) return false;
    // Hide the current tab:
    x[currentTab].style.display = "none";
    // Increase or decrease the current tab by 1:
    currentTab = currentTab + n;
    // if you have reached the end of the form...
    if (currentTab >= x.length) {
      // ... the form gets submitted:
      document.getElementById("regForm").submit();
      return false;
    }
    // Otherwise, display the correct tab:
    showTab(currentTab);
  }

  function validateForm() {
    // This function deals with validation of the form fields
    var x, y, i, valid = true;
    x = document.getElementsByClassName("tab");
    y = x[currentTab].getElementsByTagName("input");
    // A loop that checks every input field in the current tab:
    for (i = 0; i < y.length; i++) {
      // If a field is empty...
      if (y[i].value == "") {
        // add an "invalid" class to the field:
        y[i].className += " invalid";
        // and set the current valid status to false
        valid = false;
      }
    }
    // If the valid status is true, mark the step as finished and valid:
    if (valid) {
      document.getElementsByClassName("step")[currentTab].className += " finish";
    }
    return valid; // return the valid status
  }

  function fixStepIndicator(n) {
    // This function removes the "active" class of all steps...
    var i, x = document.getElementsByClassName("step");
    for (i = 0; i < x.length; i++) {
      x[i].className = x[i].className.replace(" active", "");
    }
    //... and adds the "active" class on the current step:
    x[n].className += " active";
  }


  $(document).ready(function(){
    $(".new_product_btn").click(function(){
      $(".choose").show()

      $(".close_icon").click(function(){
        $(".choose").hide()
      })      
    })

    $(".scroll_content").click(function(){
      $(".choose").hide()
      $(".variant_pop").show()

      $(".close_icon").click(function(){
        $(".variant_pop").hide()
      })
    })

    $(".check_box").click(function(){
      if ($(this).is(":checked")){
        $(".choose_producer").show()

        $(".close_icon").click(function(){
          $(".choose_producer").hide()
        })
      }
    })
  })
</script>

<style type="text/css">
/* Mark input boxes that gets an error on validation: */
input.invalid {
  background-color: #ffdddd;
}

</style>
