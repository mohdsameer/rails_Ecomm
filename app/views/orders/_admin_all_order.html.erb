<div class="orders_details_box">
  <div class="order_details_data">
    <div class="order_table_section">
      <div class="order_info_table designer_info_table">
        <div class="thead">
          <div class="thead_row">
            <div class="order_th first">&nbsp;</div>
            <div class="order_th second">Order ID</div>
            <div class="order_th three">Etsy/Amazon Order ID</div>
            <div class="order_th four">Customer Name</div>
            <div class="order_th five">Total Items</div>
            <div class="order_th six">Price</div>
            <div class="order_th seven">Order Status</div>
            <div class="order_th eight">Assignee</div>
            <div class="order_th nine">Order Date</div>
            <div class="order_th ten">Order by</div>
            <div class="order_th last">More Actions</div>
          </div>
        </div>
        <div class="tbody">
          <% orders.each do |order| %>
            <div class="tbody_row">
              <!-- Checkbox -->
              <div class="order_td td_icon first">
                <div class="custom_checkbox_wrapper">
                  <input type="checkbox" name="" id="<%= order.id %>" class="check_field">
                  <label for="<%= order.id %>"></label>
                </div>
              </div>
              <!-- Checkbox /-->

              <!-- Order ID -->
              <div class="order_td second">
                <div class="order_id_icon">
                  <span class="order_num"><%= order.id %></span>
                </div>
              </div>
              <!-- Order ID /-->

              <!-- Etsy/Amazon Order ID -->
              <div class="order_td three"><%= order.etsy_order_id %></div>
              <!-- Etsy/Amazon Order ID /-->

              <!-- Customer Name -->
              <% if order.address.present?%>
                <div class="order_td four"><%= order.address.fullname %></div>
              <%else%>
                <div class="order_td four">-</div>
              <%end%>
              <!-- Customer Name /-->

              <!-- Total Items -->
              <% if order.order_products.pluck(:product_quantity).present? %>
                <div class="order_td five"><%= order.order_products.pluck(:product_quantity).compact.sum %></div>
              <% else%>
                <div class="order_td five">-</div>
              <%end%>
              <!-- Total Items /-->

              <!-- Price -->
              <% ops = order.order_products %>
              <% sum_result = 0 %>

              <% ops.each do |op| %>
                <% record = op.product.product_producer_pricings.find_by(user_id: op.producer.id) %>

                <%  if op.front_side_image.attached? && op.back_side_image.attached? %>
                  <% cost   = (record.front_side_print_price.to_f + record.back_side_print_price.to_f) * op.product_quantity.to_i %>
                <% elsif op.front_side_image.attached? %>
                  <% cost   = record.front_side_print_price.to_f  * op.product_quantity.to_i %>
                <% elsif op.back_side_image.attached? %>
                   <% cost   = record.back_side_print_price.to_f  * op.product_quantity.to_i %>
                <% else %>
                  <% cost   = record.blank_price.to_f  * op.product_quantity.to_i %>
                <% end %>

                <% sum_result += cost %>
              <% end %>

              <div class="order_td six">$<%= sum_result %></div>
              <!-- Price /-->

              <!-- Order Status -->
              <div class="order_td seven">
                <div class="order_status_icon">
                  <% if order.order_status == "inproduction" %>
                    <div class="in_production custom_badge">
                      In Production
                    </div>
                  <% elsif order.order_status == "onhold"%>
                    <div class="custom_badge">
                      On Hold
                    </div>
                  <% elsif order.order_status == "rejected" %>
                    <div class="rejectd custom_badge">
                      Rejected 
                    </div>
                  <% elsif order.order_status == "fullfilled" %>
                    <div class="fulfiled custom_badge">
                      Fullfilled
                    </div>
                  <% else %>
                    <div class="rejectd custom_badge">
                      Cancel
                    </div>
                  <% end %>
                </div>
              </div>
              <!-- Order Status /-->

              <!-- Assignee -->
              <div class="order_td eight">
                <div class="order_priority_icon">
                  <% if order.assign_details.present? %>
                    <div class="icon_with_name">
                      <span class="assign_name"><%= order.assignee_name %></span>
                      <% if order.assign_details.last.price_for_total.present? || order.assign_details.last.price_per_design.present? %>
                        <span class="price">
                          $<%= order.assign_details.last.price_for_total.presence || order.assign_details.last.price_per_design.to_f * order.order_products.pluck(:product_quantity).compact.sum.to_i %>
                        </span>
                      <% end %>
                      <% if order.order_edit_status.eql?("completed") %>
                        <%= image_tag "complete", alt: "icon", class: "complete_icon" %>
                      <% else %>
                        <%= image_tag 'incomplete.png', alt: 'icon'%>
                      <% end %>
                    </div>
                    <% unless order.assign_details.last.price_for_total.present? || order.assign_details.last.price_per_design.present? %>
                      <span class="no_price">Not Priced</span>
                    <% end %>
                  <% else %>
                    <div class="icon_with_name not_assign">
                      <%= link_to 'Assignee', assignee_order_path(order), data: { turbo_frame: "assigne-order-modal" } %>
                      <%= image_tag "ic_user_group", alt: "icon", class: "complete_icon" %>
                    </div>
                  <% end %>
                </div>
              </div>
              <!-- Assignee / -->

              <!-- Order Date -->
              <div class="order_td nine"><%= order.order_date %></div>
              <!-- Order Date / -->

              <!-- Order by -->
              <div class="order_td ten">
                Amazon
              </div>
              <!-- Order by / -->

              <!-- More Actions -->
              <div class="order_td last">
                <div class="more_menu">
                  <% if order.order_status == "onhold" %>
                    <a href="<%= on_hold_popup_order_path(order) %>" data-turbo-frame="on-hold-order-modal" class= "more_link">
                      <%= image_tag 'View.png', alt: 'icon'%>
                    </a>
                  <% elsif order.order_status == "rejected" %>
                    <a href="<%= rejected_popup_order_path(order) %>" data-turbo-frame="rejected-order-modal" class= "more_link">
                      <%= image_tag 'View.png', alt: 'icon'%>
                    </a>
                  <% elsif order.order_status == "fullfilled" %>
                    <a href="<%= fullfilled_popup_order_path(order) %>" data-turbo-frame="fullfilled-order-modal" class= "more_link">
                      <%= image_tag 'View.png', alt: 'icon'%>
                    </a>
                  <% else %>
                    <a href="<%= in_production_popup_order_path(order) %>" data-turbo-frame="in-production-order-modal" class= "more_link">
                      <%= image_tag 'View.png', alt: 'icon'%>
                    </a>
                  <% end %>

                  <% if order.order_status == "rejected" || order.order_status == "onhold" || order.order_status == "cancel"%>
                    <%= link_to edit_order_path(order), class: 'more_link' do %>
                      <%= image_tag 'edit_row.png', alt: 'icon' %>
                    <% end %>

                    <% case order.order_status %>
                      <% when "rejected" %>
                       <a href="<%= cancel_order_order_path(order) %>"  data-turbo-frame="cancel-order-modal" class= "more_link">
                          <%= image_tag 'close.png', alt: 'icon' %>
                        </a>
                      <% else %>
                        <a href="<%= delete_confirmation_order_path(order) %>"  data-turbo-frame="destroy-order-modal" class= "more_link">
                          <%= image_tag 'delete.png', alt: 'icon' %>
                        </a>
                      <% end %>
                    <% end %>

                  <div class="more_link">
                    <span>&nbsp;</span>
                  </div>

                  <div class="drop_menu">
                    <div class="drop_icon_box">
                      <%= image_tag 'ic_more.png', alt: 'icon', class: 'more_icon' %>
                    </div>

                    <div class="menu_drop">
                      <div class="status_wrapper_pop">
                        <% if order.order_status == "onhold"%>
                          <a href="<%= order_slip_order_path(order, format: :pdf) %>" class="status_content">
                            <%= image_tag "download", alt:"icon", class:"icon" %>
                            <div class="content_text">Download ETSY Packing Slip</div>
                          </a>
                          <% unless order.assign_details.present? %>
                            <a href="<%= assignee_order_path(order)%>" data-turbo-frame="assigne-order-modal" class="status_content">
                              <%= image_tag "ic_user_group", alt:"icon", class:"icon" %>
                              <div class="content_text">Assign Order</div>
                            </a>
                          <% else %>
                            <a href="<%= assignee_remove_confirmation_order_path(order)%>" data-turbo-frame="assignee-remove-order-modal" class="status_content">
                              <%= image_tag "orange_user", alt:"icon", class:"icon" %>
                              <div class="content_text">Remove Assignee from the Order</div>
                            </a>
                            <a href="<%= update_job_price_order_path(order)%>" data-turbo-frame="update-job-price-order-modal" class="status_content">
                              <%#= image_tag "ic_user_group", alt:"icon", class:"icon" %>
                              <div class="icon">$</div>
                              <div class="content_text">Update the job price for the assignee.</div>
                            </a>
                            <a href= "<%= request_revision_order_path(order)%>" data-turbo-frame="request-revision-order-modal" class="status_content">
                              <%= image_tag "info_outline", alt:"icon", class:"icon" %>
                              <div class="content_text">Request Revision from Assignee</div>
                            </a>
                          <% end %>
                        <% elsif order.order_status == "inproduction"%>
                          <div class="status_wrapper_pop">
                            <a href="<%=new_cancel_request_order_path(order)%>" data-turbo-frame="cancel-request-order-modal" class="status_content">
                              <%= image_tag "call", alt:"icon", class:"icon" %>
                              <div class="content_text orange_text">Request Cancellation</div>
                            </a>
                            <a href="<%= update_priority_order_path(order)%>" class="status_content">
                              <%= image_tag "flash", alt:"icon", class:"icon" %>
                              <div class="content_text">Mark Order as Urgent</div>
                            </a>
                            <%= link_to send_message_order_path(order), class: 'status_content', data: {turbo_frame: "send-message-order-modal"} do %>
                              <%= image_tag "ic_chat", alt:"icon", class:"icon" %>
                              <div class="content_text">Add Additional Comment</div>
                            <%end%>
                          </div>
                        <% elsif order.order_status == "rejected"%>
                          <div class="edit_list_pop">
                            <%= link_to order_slip_order_path(order, format: :pdf), class: 'edit_box' do %>
                              <%= image_tag "download", alt:"icon", class:"icon" %>
                              <div class="edit_text">Print ETSY Packing Slip</div>
                            <% end %>

                            <div class="edit_box">
                              <a href="<%= request_revision_order_path(order)%>" data-turbo-frame="request-revision-order-modal" class="status_content">
                                <%= image_tag "info_outline", alt:"icon", class:"icon" %>
                                <div class="edit_text">Request Revision</div>
                              </a>
                            </div>

                            <div class="edit_box">
                              <a href="<%= assignee_remove_confirmation_order_path(order)%>" data-turbo-frame="assignee-remove-order-modal" class="status_content">
                                <%= image_tag "orange_user", alt:"icon", class:"icon" %>
                                <div class="edit_text">Remove Assignee from the Order</div>
                              </a>
                            </div>
                          </div>
                        <% end %>
                        <a href="<%= duplicate_order_order_path(order)%>" class="status_content">
                          <%= image_tag "bxs_copy", alt:"icon", class:"icon" %>
                          <div class="content_text">Duplicate Order
                            <div class="sub_text">Creates a new manual order</div>
                          </div>
                        </a>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <!-- More Actions / -->
            </div>
          <% end %>
        </div>
      </div>
    </div>
  </div>

  <div class="table_footer_wrap">
    <div class="content_btn">
      <div class="center"><input type="checkbox" /></div>

      <div class="content_text">Dense</div>
    </div>

    <div class="pages_content">
      <div>Rows per page:</div>

      <div>
        <select id="rowsPerPage" onchange="changeRowsPerPage(this.value)">
          <option value="">None</option>
          <option value="20">20</option>
          <option value="50">50</option>
          <option value="100">100</option>
        </select>
      </div>

      <div><%= pagination_information(orders) %></div>

      <div class="d-flex">
        <div class="pagination">
          <%= will_paginate orders %>
        </div>
      </div>
    </div>
  </div>
</div>

<script type="text/javascript">
  $('.drop_icon_box').on('click', function() {
    var dropdownContent = $(this).closest('.tbody_row').find('.menu_drop')
    $('.menu_drop').not(dropdownContent).hide();
    dropdownContent.toggle();
  });
</script>
