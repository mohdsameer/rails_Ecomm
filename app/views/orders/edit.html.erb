<div class="hero_wrapper">
  <div class="manual_order_wrapper">
    <div class="manual_order_header">
      <%= link_to orders_path,  class: "back_btn_wrap" do %>
        <%= image_tag 'start_icon.png', alt: 'icon', class: 'back_icon' %>
        <span>Back to My Orders</span>
      <% end %>
      <div class="header_text">Order ID <%= @order.id %></div>
    </div>

    <div class="manual_content_wrap">
      <div class="new_product_section">
        <div class="form_step">
          <span class="step choose_products">1</span>
          <span class="step shipping">2</span>
          <span class="step submit_offers">3</span>
        </div>

        <%= link_to add_new_product_orders_path(order_id: @order.id), class: "new_product_btn", data: { turbo_frame: "add-new-product-order-modal" } do %>
          <%= image_tag 'shopping_cart.png', alt: 'icon', class: 'cart_icon' %>
          <span class="new_text">Add New Products</span>
        <% end %>
      </div>

      <turbo-frame id="all-producer-order-modal"></turbo-frame>
      <turbo-frame id="add-new-product-order-modal"></turbo-frame>
      <turbo-frame id="order-success-popup-modal"></turbo-frame>
      <turbo-frame id="set-dimensions"></turbo-frame>
      <turbo-frame id="edit-sender"></turbo-frame>

      <% if (params[:step].present? && params[:step].eql?('shipping_method')) || @order.shippo_shipment_id.present? %>
        <%= render 'step_three', order: @order, rates: @rates, address: @order.address, sender: @order.sender %>
      <% else %>
        <%= render 'edit_step_one', order: @order %>
      <% end %>
    </div>
  </div>
</div>

<script type="text/javascript">
  $('.toggle_icon').click(function() {
    $(this).toggleClass('rotate_icon');
    $(this).closest('.product_list_section').find('.collapse_data').slideToggle();
  });

  $('.variantId').each(function() {
    var varientId = $(this).attr('id');

    function readFrontURL(input) {
      if (input.files && input.files[0]) {
        var reader = new FileReader();
        reader.onload = function(e) {
          $('#imageFrontPreview_'+varientId).css('background-image', 'url('+e.target.result +')');
          $('#imageFrontPreview_'+varientId).hide();
          $('#imageFrontPreview_'+varientId).fadeIn(650);
        }
        reader.readAsDataURL(input.files[0]);
      }
    }
    $("#front_side_image_"+varientId).change(function() {
      readFrontURL(this);
      $(this).closest('.avatar-upload').find('.avatar-edit').css('display', 'none');
      $(this).closest('.avatar-upload').find('.avatar-preview').show();
      $(this).closest('.content_img').find('.delete_img').css('display', 'flex');
    });

    function readBackURL(input) {
      if (input.files && input.files[0]) {
        var reader = new FileReader();
        reader.onload = function(e) {
          $('#imageBackPreview_'+varientId).css('background-image', 'url('+e.target.result +')');
          $('#imageBackPreview_'+varientId).hide();
          $('#imageBackPreview_'+varientId).fadeIn(650);
        }
        reader.readAsDataURL(input.files[0]);
      }
    }
    $("#back_side_image_"+varientId).change(function() {
      readBackURL(this);
      $(this).closest('.avatar-upload').find('.avatar-edit').css('display', 'none');
      $(this).closest('.avatar-upload').find('.avatar-preview').show();
      $(this).closest('.content_img').find('.delete_img').css('display', 'flex');
    });

    // increment decrement product js
    var incrementPlus;
    var incrementMinus;

    var buttonPlus  = $(".cart-qty-plus");
    var buttonMinus = $(".cart-qty-minus");

    var incrementPlus = buttonPlus.click(function() {
      var $n = $(this)
        .parent(".button-container")
        .parent(".plus_minus_wrap")
        .find("#variants_"+varientId);
      $n.val(Number($n.val())+1 );
      var proVal = $("#variants_"+varientId).val()
      $('#qty_num_'+varientId).text(proVal);
    });

    var incrementMinus = buttonMinus.click(function() {
        var $n = $(this)
        .parent(".button-container")
        .parent(".plus_minus_wrap")
        .find("#variants_"+varientId);
      var amount = Number($n.val());
      if (amount > 0) {
        $n.val(amount-1);
        var proVal = $("#variants_"+varientId).val()
        $('#qty_num_'+varientId).text(proVal);
      }
    });
  });

  $('.delete_img').click(function() {
    $(this).closest('.content_img').find('.avatar-edit').css('display', 'flex').find('.upload_field').val('');
    $(this).closest('.content_img').find('.avatar-preview').hide();
    $(this).closest('.content_img').find('.delete_img').hide();
  });
</script>

<style type="text/css">
  input.invalid {
    background-color: #ffdddd;
  }
</style>
